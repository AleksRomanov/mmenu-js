Mmenu.addons.searchfield=function(){var m=this,l=this.opts.searchfield;this.conf.searchfield;"boolean"==typeof l&&(l={add:l}),"object"!=typeof l&&(l={}),"boolean"==typeof l.panel&&(l.panel={add:l.panel}),"object"!=typeof l.panel&&(l.panel={}),l.add&&("panel"==l.addTo&&(l.panel.add=!0),l.panel.add&&(l.showSubPanels=!1,l.panel.splash&&(l.cancel=!0)),this.opts.searchfield=Mmenu.extend(l,Mmenu.options.searchfield),this.bind("close:start",function(){Mmenu.DOM.find(m.node.menu,".mm-searchfield").forEach(function(e){e.blur()})}),this.bind("initPanels:after",function(e){var n,s=Mmenu.$(e),a=Mmenu.$();switch(l.panel.add&&(a=m._initSearchPanel(s)),l.addTo){case"panels":n=s;break;case"panel":n=a;break;default:n="string"==typeof l.addTo?Mmenu.$(m.node.menu).find(l.addTo):Mmenu.$(l.addTo)}(n.each(function(e,n){var s=m._initSearchfield(Mmenu.$(n));l.search&&s.length&&m._initSearching(s)}),l.noResults)&&(l.panel.add?a:s).each(function(e,n){m._initNoResultsMsg(Mmenu.$(n))})}),this.clck.push(function(e,n){if(n.inMenu&&e.matches(".mm-searchfield__btn")){var s=Mmenu.$(e);if(e.matches(".mm-btn_close")){var a=s.closest(".mm-searchfield").find("input");return a.val(""),m.search(a),!0}if(e.matches(".mm-btn_next"))return s.closest(".mm-searchfield").submit(),!0}}))},Mmenu.options.searchfield={add:!1,addTo:"panels",cancel:!1,noResults:"No results found.",placeholder:"Search",panel:{add:!1,dividers:!0,fx:"none",id:null,splash:null,title:"Search"},search:!0,showTextItems:!1,showSubPanels:!0},Mmenu.configs.searchfield={clear:!1,form:!1,input:!1,submit:!1},Mmenu.prototype._initSearchPanel=function(e){var n=this.opts.searchfield;this.conf.searchfield;if(Mmenu.$(this.node.pnls).children(".mm-panel_search").length)return Mmenu.$();var s=Mmenu.$('<div class="mm-panel_search " />').append("<ul />").appendTo(this.node.pnls);switch(n.panel.id&&(s[0].id=n.panel.id),n.panel.title&&s[0].setAttribute("data-mm-title",n.panel.title),n.panel.fx){case!1:break;case"none":s.addClass("mm-panel_noanimation");break;default:s.addClass("mm-panel_fx-"+n.panel.fx)}return n.panel.splash&&s.append('<div class="mm-panel__searchsplash">'+n.panel.splash+"</div>"),this._initPanels(s.get()),s},Mmenu.prototype._initSearchfield=function(e){var n=this.opts.searchfield,s=this.conf.searchfield;if(e.parent(".mm-listitem_vertical").length)return Mmenu.$();if(e.find(".mm-searchfield").length)return e.find(".mm-searchfield");var a=Mmenu.$("<"+(s.form?"form":"div")+' class="mm-searchfield" />'),m=Mmenu.$('<div class="mm-searchfield__input" />'),l=Mmenu.$('<input placeholder="'+this.i18n(n.placeholder)+'" type="text" autocomplete="off" />');function i(e,n){if(n)for(var s in n)e[0].setAttribute(s,n[s])}return m.append(l).appendTo(a),e.prepend(a),e.hasClass("mm-panel")&&e.addClass("mm-panel_has-searchfield"),i(l,s.input),s.clear&&Mmenu.$('<a class="mm-btn mm-btn_close mm-searchfield__btn" href="#" />').appendTo(m),i(a,s.form),s.form&&s.submit&&!s.clear&&Mmenu.$('<a class="mm-btn mm-btn_next mm-searchfield__btn" href="#" />').appendTo(m),n.cancel&&Mmenu.$('<a href="#" class="mm-searchfield__cancel">'+this.i18n("cancel")+"</a>").appendTo(a),a},Mmenu.prototype._initSearching=function(e){var n=this,s=this.opts.searchfield,a=(this.conf.searchfield,{});e.closest(".mm-panel_search").length?(a.$pnls=Mmenu.$(this.node.pnls).find(".mm-panel"),a.$nrsp=e.closest(".mm-panel")):e.closest(".mm-panel").length?(a.$pnls=e.closest(".mm-panel"),a.$nrsp=a.$pnls):(a.$pnls=Mmenu.$(this.node.pnls).find(".mm-panel"),a.$nrsp=Mmenu.$(this.node.menu)),a.$pnls=a.$pnls.not(function(e,n){var s=n.parentElement;return s&&s.matches(".mm-listitem_vertical")}),s.panel.add&&(a.$pnls=a.$pnls.not(".mm-panel_search"));var m=e.find("input"),l=e.find(".mm-searchfield__cancel"),i=Mmenu.$(this.node.pnls).children(".mm-panel_search"),t=a.$pnls.find(".mm-listitem");a.$itms=t.not(".mm-listitem_divider"),a.$dvdr=t.filter(".mm-listitem_divider"),s.panel.add&&s.panel.splash&&m.off("focus.mm-searchfield-splash").on("focus.mm-searchfield-splash",function(e){n.openPanel(i[0])}),s.cancel&&(m.off("focus.mm-searchfield-cancel").on("focus.mm-searchfield-cancel",function(e){l.addClass("mm-searchfield__cancel-active")}),l.off("click.mm-searchfield-splash").on("click.mm-searchfield-splash",function(e){e.preventDefault(),l.removeClass("mm-searchfield__cancel-active"),i.hasClass("mm-panel_opened")&&n.openPanel(Mmenu.$(n.node.pnls).children(".mm-panel_opened-parent").last()[0])})),s.panel.add&&"panel"==s.addTo&&this.bind("openPanel:finish",function(e){e===i[0]&&m.focus()}),m[0].mmSearchfield=a,m.off("input.mm-searchfield").on("input.mm-searchfield",function(e){switch(e.keyCode){case 9:case 16:case 17:case 18:case 37:case 38:case 39:case 40:break;default:n.search(m)}}),this.search(m)},Mmenu.prototype._initNoResultsMsg=function(e){var n=this.opts.searchfield;this.conf.searchfield;if(e.closest(".mm-panel").length||(e=Mmenu.$(this.node.pnls).children(".mm-panel").first()),!e.children(".mm-panel__noresultsmsg").length){var s=e.children(".mm-listview").first(),a=Mmenu.$('<div class="mm-panel__noresultsmsg mm-hidden" />').append(this.i18n(n.noResults));s.length?a.insertAfter(s):a.prependTo(e)}},Mmenu.prototype.search=function(m,l){var i=this,t=this.opts.searchfield;this.conf.searchfield;m=m||Mmenu.$(this.node.menu).find(".mm-searchfield").children("input").first(),l=(l=l||""+m.val()).toLowerCase().trim();var e=m[0].mmSearchfield,n=m.closest(".mm-searchfield").find(".mm-btn"),s=Mmenu.$(this.node.pnls).children(".mm-panel_search"),a=e.$pnls,d=e.$itms,c=e.$dvdr,r=e.$nrsp;if(d.removeClass("mm-listitem_nosubitems").find(".mm-btn_fullwidth-search").removeClass("mm-btn_fullwidth-search mm-btn_fullwidth"),s.children(".mm-listview").empty(),a.scrollTop(0),l.length){if(d.add(c).addClass("mm-hidden"),d.each(function(e,n){var s=Mmenu.$(n),a="a";(t.showTextItems||t.showSubPanels&&s.find(".mm-btn_next"))&&(a="a, span"),-1<s.children(a).not(".mm-btn_next").text().toLowerCase().indexOf(l)&&s.removeClass("mm-hidden")}),t.panel.add){var h=[];a.each(function(e,n){var s=Mmenu.filterListItems(Mmenu.DOM.find(n,".mm-listitem"));if(s.length){if(t.panel.dividers){var a=Mmenu.DOM.create("li.mm-listitem.mm-listitem_divider");a.innerHTML=n.querySelector(".mm-navbar__title").innerHTML,h.push(a)}s.forEach(function(e){h.push(e.cloneNode(!0))})}}),h.forEach(function(e){e.querySelectorAll(".mm-toggle, .mm-check, .mm-btn").forEach(function(e){e.remove()})}),s.children(".mm-listview").append(h),this.openPanel(s[0])}else t.showSubPanels&&a.each(function(e,n){var s=Mmenu.DOM.find(n,".mm-listitem");Mmenu.filterListItems(s).forEach(function(e){var n=e.mmChild;n&&Mmenu.DOM.find(n,".mm-listitem").forEach(function(e){e.classList.remove("mm-hidden")})})}),Mmenu.$(a.get().reverse()).each(function(e,n){Mmenu.$(n);var s=n.mmParent;if(s){var a=Mmenu.DOM.find(n,".mm-listitem");Mmenu.filterListItems(a).length?s.matches(".mm-hidden")&&Mmenu.$(s).removeClass("mm-hidden").children(".mm-btn_next").not(".mm-btn_fullwidth").addClass("mm-btn_fullwidth").addClass("mm-btn_fullwidth-search"):m.closest(".mm-panel").length||((n.matches(".mm-panel_opened")||n.matches(".mm-panel_opened-parent"))&&setTimeout(function(){i.openPanel(s.closest(".mm-panel"))},(e+1)*(1.5*i.conf.openingInterval)),s.classList.add("mm-listitem_nosubitems"))}}),a.each(function(e,n){var s=Mmenu.DOM.find(n,".mm-listitem");Mmenu.filterListItems(s).forEach(function(e){Mmenu.$(e).prevAll(".mm-listitem_divider").first().removeClass("mm-hidden")})});n.removeClass("mm-hidden"),r.find(".mm-panel__noresultsmsg")[d.not(".mm-hidden").length?"addClass":"removeClass"]("mm-hidden"),t.panel.add&&(t.panel.splash&&s.find(".mm-panel__searchsplash").addClass("mm-hidden"),d.add(c).removeClass("mm-hidden"))}else d.add(c).removeClass("mm-hidden"),n.addClass("mm-hidden"),r.find(".mm-panel__noresultsmsg").addClass("mm-hidden"),t.panel.add&&(t.panel.splash?s.find(".mm-panel__searchsplash").removeClass("mm-hidden"):m.closest(".mm-panel_search").length||this.openPanel(Mmenu.$(this.node.pnls).children(".mm-panel_opened-parent").last()[0]));this.trigger("updateListview")};