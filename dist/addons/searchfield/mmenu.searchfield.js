Mmenu.addons.searchfield=function(){var l=this,a=this.opts.searchfield;this.conf.searchfield;"boolean"==typeof a&&(a={add:a}),"object"!=typeof a&&(a={}),"boolean"==typeof a.panel&&(a.panel={add:a.panel}),"object"!=typeof a.panel&&(a.panel={}),a.add&&("panel"==a.addTo&&(a.panel.add=!0),a.panel.add&&(a.showSubPanels=!1,a.panel.splash&&(a.cancel=!0)),this.opts.searchfield=Mmenu.extend(a,Mmenu.options.searchfield),this.bind("close:start",function(){Mmenu.$(l.node.menu).find(".mm-searchfield").children("input").blur()}),this.bind("initPanels:after",function(e){var n,s=Mmenu.$();switch(a.panel.add&&(s=l._initSearchPanel(e)),a.addTo){case"panels":n=e;break;case"panel":n=s;break;default:n=Mmenu.$(l.node.menu).find(a.addTo)}(n.each(function(e,n){var s=l._initSearchfield(Mmenu.$(n));a.search&&s.length&&l._initSearching(s)}),a.noResults)&&(a.panel.add?s:e).each(function(e,n){l._initNoResultsMsg(Mmenu.$(n))})}),this.clck.push(function(e,n){if(n.inMenu&&e.classList.contains("mm-searchfield__btn")){var s=Mmenu.$(e);if(e.classList.contains("mm-btn_close")){var a=s.closest(".mm-searchfield").find("input");return a.val(""),l.search(a),!0}if(e.classList.contains("mm-btn_next"))return s.closest(".mm-searchfield").submit(),!0}}))},Mmenu.options.searchfield={add:!1,addTo:"panels",cancel:!1,noResults:"No results found.",placeholder:"Search",panel:{add:!1,dividers:!0,fx:"none",id:null,splash:null,title:"Search"},search:!0,showTextItems:!1,showSubPanels:!0},Mmenu.configs.searchfield={clear:!1,form:!1,input:!1,submit:!1},Mmenu.prototype._initSearchPanel=function(e){var n=this.opts.searchfield;this.conf.searchfield;if(Mmenu.$(this.node.pnls).children(".mm-panel_search").length)return Mmenu.$();var s=Mmenu.$('<div class="mm-panel_search " />').append("<ul />").appendTo(this.node.pnls);switch(n.panel.id&&(s[0].id=n.panel.id),n.panel.title&&s[0].setAttribute("data-mm-title",n.panel.title),n.panel.fx){case!1:break;case"none":s.addClass("mm-panel_noanimation");break;default:s.addClass("mm-panel_fx-"+n.panel.fx)}return n.panel.splash&&s.append('<div class="mm-panel__searchsplash">'+n.panel.splash+"</div>"),this._initPanels(s),s},Mmenu.prototype._initSearchfield=function(e){var n=this.opts.searchfield,s=this.conf.searchfield;if(e.parent(".mm-listitem_vertical").length)return Mmenu.$();if(e.find(".mm-searchfield").length)return e.find(".mm-searchfield");var a=Mmenu.$("<"+(s.form?"form":"div")+' class="mm-searchfield" />'),l=Mmenu.$('<div class="mm-searchfield__input" />'),i=Mmenu.$('<input placeholder="'+this.i18n(n.placeholder)+'" type="text" autocomplete="off" />');function m(e,n){if(n)for(var s in n)e[0].setAttribute(s,n[s])}return l.append(i).appendTo(a),e.prepend(a),e.hasClass("mm-panel")&&e.addClass("mm-panel_has-searchfield"),m(i,s.input),s.clear&&Mmenu.$('<a class="mm-btn mm-btn_close mm-searchfield__btn" href="#" />').appendTo(l),m(a,s.form),s.form&&s.submit&&!s.clear&&Mmenu.$('<a class="mm-btn mm-btn_next mm-searchfield__btn" href="#" />').appendTo(l),n.cancel&&Mmenu.$('<a href="#" class="mm-searchfield__cancel">'+this.i18n("cancel")+"</a>").appendTo(a),a},Mmenu.prototype._initSearching=function(e){var n=this,s=this.opts.searchfield,a=(this.conf.searchfield,{});e.closest(".mm-panel_search").length?(a.$pnls=Mmenu.$(this.node.pnls).find(".mm-panel"),a.$nrsp=e.closest(".mm-panel")):e.closest(".mm-panel").length?(a.$pnls=e.closest(".mm-panel"),a.$nrsp=a.$pnls):(a.$pnls=Mmenu.$(this.node.pnls).find(".mm-panel"),a.$nrsp=Mmenu.$(this.node.menu)),a.$pnls=a.$pnls.not(function(e,n){var s=n.parentElement;return s&&s.classList.contains("mm-listitem_vertical")}),s.panel.add&&(a.$pnls=a.$pnls.not(".mm-panel_search"));var l=e.find("input"),i=e.find(".mm-searchfield__cancel"),m=Mmenu.$(this.node.pnls).children(".mm-panel_search"),t=a.$pnls.find(".mm-listitem");a.$itms=t.not(".mm-listitem_divider"),a.$dvdr=t.filter(".mm-listitem_divider"),s.panel.add&&s.panel.splash&&l.off("focus.mm-searchfield-splash").on("focus.mm-searchfield-splash",function(e){n.openPanel(m)}),s.cancel&&(l.off("focus.mm-searchfield-cancel").on("focus.mm-searchfield-cancel",function(e){i.addClass("mm-searchfield__cancel-active")}),i.off("click.mm-searchfield-splash").on("click.mm-searchfield-splash",function(e){e.preventDefault(),i.removeClass("mm-searchfield__cancel-active"),m.hasClass("mm-panel_opened")&&n.openPanel(Mmenu.$(n.node.pnls).children(".mm-panel_opened-parent").last())})),s.panel.add&&"panel"==s.addTo&&this.bind("openPanel:finish",function(e){e[0]===m[0]&&l.focus()}),l[0].mmSearchfield=a,l.off("input.mm-searchfield").on("input.mm-searchfield",function(e){switch(e.keyCode){case 9:case 16:case 17:case 18:case 37:case 38:case 39:case 40:break;default:n.search(l)}}),this.search(l)},Mmenu.prototype._initNoResultsMsg=function(e){var n=this.opts.searchfield;this.conf.searchfield;if(e.closest(".mm-panel").length||(e=Mmenu.$(this.node.pnls).children(".mm-panel").first()),!e.children(".mm-panel__noresultsmsg").length){var s=e.children(".mm-listview").first(),a=Mmenu.$('<div class="mm-panel__noresultsmsg mm-hidden" />').append(this.i18n(n.noResults));s.length?a.insertAfter(s):a.prependTo(e)}},Mmenu.prototype.search=function(l,i){var m=this,t=this.opts.searchfield;this.conf.searchfield;l=l||Mmenu.$(this.node.menu).find(".mm-searchfield").children("input").first(),i=(i=i||""+l.val()).toLowerCase().trim();var e=l[0].mmSearchfield,n=l.closest(".mm-searchfield").find(".mm-btn"),s=Mmenu.$(this.node.pnls).children(".mm-panel_search"),a=e.$pnls,d=e.$itms,c=e.$dvdr,r=e.$nrsp;if(d.removeClass("mm-listitem_nosubitems").find(".mm-btn_fullwidth-search").removeClass("mm-btn_fullwidth-search mm-btn_fullwidth"),s.children(".mm-listview").empty(),a.scrollTop(0),i.length){if(d.add(c).addClass("mm-hidden"),d.each(function(e,n){var s=Mmenu.$(n),a="a";(t.showTextItems||t.showSubPanels&&s.find(".mm-btn_next"))&&(a="a, span"),-1<s.children(a).not(".mm-btn_next").text().toLowerCase().indexOf(i)&&s.removeClass("mm-hidden")}),t.panel.add){var h=Mmenu.$();a.each(function(e,n){var s=Mmenu.$(n),a=Mmenu.filterListItems(s.find(".mm-listitem")).clone(!0);a.length&&(t.panel.dividers&&(h=h.add('<li class="mm-listitem mm-listitem_divider">'+s.find(".mm-navbar__title").text()+"</li>")),h=h.add(a))}),h.find(".mm-toggle, .mm-check, .mm-btn").remove(),s.children(".mm-listview").append(h),this.openPanel(s)}else t.showSubPanels&&a.each(function(e,n){var s=Mmenu.$(n);Mmenu.filterListItems(s.find(".mm-listitem")).each(function(e,n){var s=n.mmChild;s&&s.find(".mm-listview").children().removeClass("mm-hidden")})}),Mmenu.$(a.get().reverse()).each(function(e,n){var s=Mmenu.$(n),a=n.mmParent;a&&(Mmenu.filterListItems(s.find(".mm-listitem")).length?a.hasClass("mm-hidden")&&a.removeClass("mm-hidden").children(".mm-btn_next").not(".mm-btn_fullwidth").addClass("mm-btn_fullwidth").addClass("mm-btn_fullwidth-search"):l.closest(".mm-panel").length||((s.hasClass("mm-panel_opened")||s.hasClass("mm-panel_opened-parent"))&&setTimeout(function(){m.openPanel(a.closest(".mm-panel"))},(e+1)*(1.5*m.conf.openingInterval)),a.addClass("mm-listitem_nosubitems")))}),Mmenu.filterListItems(a.find(".mm-listitem")).each(function(e,n){Mmenu.$(n).prevAll(".mm-listitem_divider").first().removeClass("mm-hidden")});n.removeClass("mm-hidden"),r.find(".mm-panel__noresultsmsg")[d.not(".mm-hidden").length?"addClass":"removeClass"]("mm-hidden"),t.panel.add&&(t.panel.splash&&s.find(".mm-panel__searchsplash").addClass("mm-hidden"),d.add(c).removeClass("mm-hidden"))}else d.add(c).removeClass("mm-hidden"),n.addClass("mm-hidden"),r.find(".mm-panel__noresultsmsg").addClass("mm-hidden"),t.panel.add&&(t.panel.splash?s.find(".mm-panel__searchsplash").removeClass("mm-hidden"):l.closest(".mm-panel_search").length||this.openPanel(Mmenu.$(this.node.pnls).children(".mm-panel_opened-parent").last()));this.trigger("updateListview")};