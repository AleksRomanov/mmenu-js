Mmenu.addons.keyboardNavigation=function(){var n=this;if(!Mmenu.support.touch){var t=this.opts.keyboardNavigation;if("boolean"!=typeof t&&"string"!=typeof t||(t={enable:t}),"object"!=typeof t&&(t={}),this.opts.keyboardNavigation=Mmenu.extend(t,Mmenu.options.keyboardNavigation),t.enable){var e=Mmenu.$('<button class="mm-tabstart" />'),a=Mmenu.$('<button class="mm-tabend" />'),i=Mmenu.$('<button class="mm-tabend" />');this.bind("initMenu:after",function(){t.enhance&&n.node.menu.classList.add("mm-menu_keyboardfocus"),n._initWindow_keyboardNavigation(t.enhance)}),this.bind("initOpened:before",function(){Mmenu.$(n.node.menu).prepend(e).append(a).children(".mm-navbars-top, .mm-navbars-bottom").children(".mm-navbar").children("a.mm-title").attr("tabindex",-1)}),this.bind("initBlocker:after",function(){Mmenu.node.$blck.append(i).children("a").addClass("mm-tabstart")});var m="input, select, textarea, button, label, a[href]";function o(e){e=e||this.node.$pnls.children(".mm-panel_opened");var n=Mmenu.$(),a=Mmenu.$(this.node.menu).children(".mm-navbars_top, .mm-navbars_bottom").children(".mm-navbar");a.find(m).filter(":focus").length||("default"==t.enable&&((n=e.children(".mm-listview").find("a[href]").not(".mm-hidden")).length||(n=e.find(m).not(".mm-hidden")),n.length||(n=a.find(m).not(".mm-hidden"))),n.length||(n=Mmenu.$(this.node.menu).children(".mm-tabstart")),n.first().focus())}this.bind("open:finish",o),this.bind("openPanel:finish",o),this.bind("initOpened:after:sr-aria",function(){var e=Mmenu.$(n.node.menu).add(Mmenu.node.$blck).children(".mm-tabstart, .mm-tabend");Mmenu.sr_aria(e,"hidden",!0),Mmenu.sr_role(e,"presentation")})}}},Mmenu.options.keyboardNavigation={enable:!1,enhance:!1},Mmenu.prototype._initWindow_keyboardNavigation=function(e){Mmenu.$(window).off("keydown.mm-offCanvas").off("focusin.mm-keyboardNavigation").on("focusin.mm-keyboardNavigation",function(e){if(Mmenu.$("html").hasClass("mm-wrapper_opened")){var n=Mmenu.$(e.target);if(n.is(".mm-tabend")){var a=Mmenu.$();n.parent().is(".mm-menu")&&Mmenu.node.$blck&&(a=Mmenu.node.$blck),n.parent().is(".mm-wrapper__blocker")&&(a=Mmenu.$("body").find(".mm-menu_offcanvas").filter(".mm-menu_opened")),a.length||(a=n.parent()),a.children(".mm-tabstart").focus()}}}).off("keydown.mm-keyboardNavigation").on("keydown.mm-keyboardNavigation",function(e){var n=Mmenu.$(e.target),a=n.closest(".mm-menu");if(a.length){a[0].mmenu;if(n.is("input, textarea"));else switch(e.keyCode){case 13:(n.is(".mm-toggle")||n.is(".mm-check"))&&n.trigger("click.mm");break;case 32:case 37:case 38:case 39:case 40:e.preventDefault()}}}),e&&Mmenu.$(window).off("keydown.mm-keyboardNavigation").on("keydown.mm-keyboardNavigation",function(e){var n=Mmenu.$(e.target),a=n.closest(".mm-menu");if(a.length){var t=a[0].mmenu;if(n.is("input"))switch(e.keyCode){case 27:n.val("")}else switch(e.keyCode){case 8:var i=a.find(".mm-panel_opened")[0].mmParent;i&&i.length&&t.openPanel(i.closest(".mm-panel"));break;case 27:a.hasClass("mm-menu_offcanvas")&&t.close()}}})};